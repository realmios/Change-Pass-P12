<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Realmios P12 Password Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Forge -->
<script src="https://cdn.jsdelivr.net/npm/node-forge@1.3.1/dist/forge.min.js"></script>

<style>
:root{
  --bg:#0f1220;
  --card:#171a2b;
  --text:#e8eaf6;
  --muted:#9aa0ff;
  --accent:#6c7cff;
  --danger:#ff5f5f;
}
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#0f1220,#1b1f3b);
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--text);
}
.container{
  width:100%;
  max-width:440px;
  background:var(--card);
  padding:22px;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,.45);
}
h1{
  text-align:center;
  font-size:20px;
  margin:0 0 10px;
}
.desc{
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin-bottom:18px;
}
.field{margin-bottom:14px}
label{
  display:block;
  font-size:13px;
  margin-bottom:6px;
}
input[type="file"],
input[type="password"]{
  width:100%;
  padding:11px 12px;
  border-radius:10px;
  border:1px solid #2a2f55;
  background:#10132a;
  color:var(--text);
}
input::placeholder{color:#6d72b5}
button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:var(--accent);
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}
button:disabled{opacity:.6;cursor:not-allowed}
.error{
  margin-top:12px;
  font-size:13px;
  text-align:center;
  color:var(--danger);
}
.success{
  margin-top:12px;
  font-size:13px;
  text-align:center;
  color:#7dff9c;
}
.notice{
  margin-top:14px;
  font-size:12px;
  color:#b8bcff;
  background:#10132a;
  padding:10px;
  border-radius:10px;
  line-height:1.5;
}
.footer{
  margin-top:14px;
  text-align:center;
  font-size:11px;
  opacity:.6;
}
</style>
</head>

<body>
<div class="container">
  <h1>üîê Realmios P12 Tool</h1>
  <div class="desc">
    ƒê·ªïi m·∫≠t kh·∫©u file <b>.p12</b><br>
    X·ª≠ l√Ω 100% trong tr√¨nh duy·ªát
  </div>

  <div class="field">
    <label>Ch·ªçn file .p12</label>
    <input type="file" id="p12File" accept=".p12">
  </div>

  <div class="field">
    <label>M·∫≠t kh·∫©u hi·ªán t·∫°i</label>
    <input type="password" id="oldPass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u c≈©">
  </div>

  <div class="field">
    <label>M·∫≠t kh·∫©u m·ªõi</label>
    <input type="password" id="newPass" placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
  </div>

  <div class="field">
    <label>M·∫≠t kh·∫©u Admin</label>
    <input type="password" id="adminPass" placeholder="Ch·ªâ d√†nh cho admin">
  </div>

  <button id="btn" onclick="changePassword()">ƒê·ªïi m·∫≠t kh·∫©u & t·∫£i v·ªÅ</button>

  <div id="msg" class="error"></div>

  <div class="notice">
    ‚ö†Ô∏è L∆∞u √Ω iOS:<br>
    File t·∫£i v·ªÅ c√≥ ƒëu√¥i <b>.bin</b><br>
    üëâ ƒê·ªïi l·∫°i th√†nh <b>.p12</b> sau khi t·∫£i
  </div>

  <div class="footer">
    Realmios Tool ¬∑ Client-side only
  </div>
</div>
<script>
(function(_0x5a3d,_0x2c6b){
  const _0x4e8a=function(_0x1d23){
    while(--_0x1d23){
      _0x5a3d['push'](_0x5a3d['shift']());
    }
  };
  _0x4e8a(++_0x2c6b);
}(_0x3b91,0x1a3));

const _0x4f12=function(_0x2c6b,_0x5a3d){
  _0x2c6b=_0x2c6b-0x0;
  let _0x4e8a=_0x3b91[_0x2c6b];
  return _0x4e8a;
};

function changePassword(){
  (async()=>{
    const _f=document[_0x4f12('0x0')](_0x4f12('0x1'))[_0x4f12('0x2')][0x0];
    const _o=document[_0x4f12('0x0')](_0x4f12('0x3'))[_0x4f12('0x4')];
    const _n=document[_0x4f12('0x0')](_0x4f12('0x5'))[_0x4f12('0x4')];
    const _a=document[_0x4f12('0x0')](_0x4f12('0x6'))[_0x4f12('0x4')];

    const _m=document[_0x4f12('0x0')](_0x4f12('0x7'));
    const _b=document[_0x4f12('0x0')](_0x4f12('0x8'));

    _m[_0x4f12('0x9')] = '';

    if(atob(_0x4f12('0xa')) !== _a){
      _m[_0x4f12('0x9')] = '‚ùå B·∫°n kh√¥ng c√≥ quy·ªÅn s·ª≠ d·ª•ng c√¥ng c·ª• n√†y';
      return;
    }

    if(!_f) return _m[_0x4f12('0x9')] = '‚ùå Ch∆∞a ch·ªçn file .p12';
    if(!_o) return _m[_0x4f12('0x9')] = '‚ùå Ch∆∞a nh·∫≠p m·∫≠t kh·∫©u c≈©';
    if(!_n) return _m[_0x4f12('0x9')] = '‚ùå Ch∆∞a nh·∫≠p m·∫≠t kh·∫©u m·ªõi';

    _b[_0x4f12('0xb')] = true;
    _b[_0x4f12('0x9')] = 'ƒêang x·ª≠ l√Ω...';

    try{
      const _buf = await _f.arrayBuffer();
      const _bin = String.fromCharCode(...new Uint8Array(_buf));
      const _asn = forge.asn1.fromDer(_bin);
      const _p12 = forge.pkcs12.pkcs12FromAsn1(_asn,_o);

      const _kB = _p12.getBags({bagType:forge.pki.oids.pkcs8ShroudedKeyBag});
      const _key = _kB[forge.pki.oids.pkcs8ShroudedKeyBag][0].key;

      const _cB = _p12.getBags({bagType:forge.pki.oids.certBag});
      const _crt = _cB[forge.pki.oids.certBag][0].cert;

      const _newAsn = forge.pkcs12.toPkcs12Asn1(_key,[_crt],_n,{algorithm:'3des'});
      const _der = forge.asn1.toDer(_newAsn).getBytes();
      const _arr = new Uint8Array(_der.length);

      for(let i=0;i<_der.length;i++) _arr[i]=_der.charCodeAt(i);

      const _base=_f.name.replace(/\.(p12|P12)$/,'');
      const _ios=/iphone|ipad|ipod/i.test(navigator.userAgent);
      const _name=_ios?`realmios-${_base}.p12.bin`:`realmios-${_base}.p12`;

      const _blob=new Blob([_arr],{type:'application/x-pkcs12'});
      const _a=document.createElement('a');
      _a.href=URL.createObjectURL(_blob);
      _a.download=_name;
      _a.click();

      _m.className='success';
      _m[_0x4f12('0x9')]='‚úÖ ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng';
    }catch(e){
      _m.className='error';
      _m[_0x4f12('0x9')]='‚ùå Sai m·∫≠t kh·∫©u c≈© ho·∫∑c file kh√¥ng h·ª£p l·ªá';
    }

    _b[_0x4f12('0xb')]=false;
    _b[_0x4f12('0x9')]='ƒê·ªïi m·∫≠t kh·∫©u & t·∫£i v·ªÅ';
  })();
}

function _0x3b91(){
  return [
    'getElementById','p12File','files',
    'oldPass','value','newPass','adminPass',
    'msg','btn','textContent','SEBpMDkwOTE1MDk=',
    'disabled'
  ];
}
</script>  
</body>
</html>
